---
author: RPSchan
---
## 速度重視的文件壓縮格式選擇Tips

### 一塊老USB Flash的情況
直接copy大文件（硬盤的img鏡像備份文件），平均寫入速度爲92MB/s。因爲img鏡像包含了大量爲0的空內容，非壓縮存儲非常浪費空間。

使用zip（deflate）的fastest，平均寫入速度爲85MB/s，雖然有效節省容量，但是寫入速度偏低。

使用7z打包的zstd fastest（fast1），平均寫入速度爲144MB/s。使用7z打包的brotli fastest，平均寫入速度爲220MB/s。

這些現代快速壓縮算法，壓縮率大致爲deflate的fastest到normal，但是速度大大提高，對於存儲明確有大量冗餘的數據，比zip或直接複製好得多。

壓縮率更高但更慢的lzma、bzip對於此類情況幾乎沒有價值。LZ4、LZ5等解壓縮速度極快的算法，由於壓縮時的表現全面不如zstd，也不採用。（題外話，但是遊戲用的ROM發佈卻非常合適，可以提高讀取速度節省Flash容量）

### 文件系統壓縮
理論上更好的解決方案是支持LZ4、zstd等現代快速壓縮算法的文件系統，開啓文件系統壓縮。NTFS自帶的老壓縮算法實在太慢，上面的老USB Flash寫入img文件僅22MB/s，壓縮率也不理想。但是不論是Win10還是主要的Linux發行版，目前並沒有自帶支持，實用起來太麻煩。

### 吐槽
都202x年了，還在推薦用tar，比起windows環境大家都會乖乖用zip、7z，簡直太原始了。在disk上用tape archive不覺得很違和嗎，不知道爲什麼從79年用到現在還不知道改。雖然有人做了dar，但是根本沒普及。

主要問題就是tar就是最簡單的打包，沒有索引導致打開tar文件/列出tar包中的文件就需要讀取幾乎整個tar。假設你有個100GB的tar包，通過1000M的網線訪問存儲，打開文件還沒有進行任何操作就需要先等十幾分鐘。

相對而言7z不僅對索引、加密、UTF8的支援比較好，而且內部使用的壓縮方式可變，7z有了對應的格式plugin後可以使用LZ4、LZ5、zstd、brotli等等現代壓縮格式。這些格式的開源實現都沒有打包功能，tar打包後壓縮的話，甚至會複製1次再壓縮1次，簡直蠢出太陽系，就算用89年的zip也好好多了。

居然還有SX在打包上TB的方案裏推薦tar.gz，放到離線存儲裏以後打開tar就要讀上T的內容，這TMD誰受得了啊。